<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Diary - Audio Recipe Recorder</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;0,700;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Payment Gateways -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <!-- Configuration loaded from server (contains environment variables) -->
    <script src="/config.js"></script>
</head>
<body>
    <div class="container">
        <!-- LANDING VIEW -->
        <div id="landingView" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center;">
            <img src="images/recipediary_icon.png" alt="Recipe Diary" class="app-logo-large" style="width: 120px; height: 120px; margin-bottom: 20px;">
            <h1 style="font-family: var(--font-heading); font-weight: 900; font-style: italic; margin-bottom: 10px; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">Recipe Diary</h1>
            <p style="font-size: 1.2rem; color: rgba(255, 255, 255, 0.9); margin-bottom: 30px; max-width: 500px; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                Record your voice, and let AI transcribe and format it into a beautiful recipe card.
            </p>
            <button class="btn btn-primary btn-large" id="landingLoginBtn" style="padding: 15px 40px; font-size: 1.1rem;">
                <span class="icon">üîê</span> Login / Sign Up to Start
            </button>
        </div>

        <!-- APP CONTENT -->
        <div id="appContent" style="display: none;">
            <header>
            <div class="top-bar">
                <div class="logo-container">
                    <img src="images/recipediary_icon.png" alt="Recipe Diary" class="app-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                    <span style="display:none; font-size: 2.5rem;">üç≥</span>
                </div>

                <div class="user-controls" id="authStatus">
                    <div id="authLoading" class="auth-loading" style="display: none;">Loading...</div>
                    
                    <div id="authUser" class="auth-user" style="display: none;">
                        <div class="user-info-group">
                            <span class="user-email" id="userEmail"></span>
                            <button class="btn-icon" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
                            <button class="btn-text" id="logoutBtn">Logout</button>
                        </div>
                        <div class="credits-group">
                            <div class="credit-badge" id="creditDisplay" title="Available Credits">
                                <span class="icon">ü™ô</span> <span id="userCredits">0</span> Credits
                            </div>
                            <button class="btn-buy-credits" id="buyCreditsBtn" title="Buy Credits">
                                <span class="icon">ü™ô</span> Buy More
                            </button>
                        </div>
                    </div>

                    <div id="authGuest" class="auth-guest">
                        <button class="btn-login" id="loginBtn">Login</button>
                    </div>
                </div>
            </div>
            
            <nav class="main-nav">
                <button class="nav-btn active" id="navRecord">
                    <span class="icon">üéôÔ∏è</span> Record
                </button>
                <button class="nav-btn" id="navGallery">
                    <span class="icon">ÔøΩ</span> My Recipes
                </button>
            </nav>
        </header>

        <!-- RECORD VIEW -->
        <main id="recordView">
            <div class="input-methods-container">
                <!-- Record Section -->
                <div class="input-method-section active" id="recordSection">
                    <div class="section-header">
                        <h2>üéôÔ∏è Record Audio</h2>
                    </div>
                    <div class="section-content">
                        <div class="language-selector-compact">
                            <label for="languageSelectRecord">Speaking Language:</label>
                            <select id="languageSelectRecord" class="language-select">
                                <option value="en-US">English (US)</option>
                                <option value="en-GB">English (UK)</option>
                                <option value="es-ES">Spanish (Spain)</option>
                                <option value="es-MX">Spanish (Mexico)</option>
                                <option value="hi-IN">Hindi (India)</option>
                                <option value="ta-IN">Tamil (India)</option>
                                <option value="te-IN">Telugu (India)</option>
                                <option value="ml-IN">Malayalam (India)</option>
                                <option value="kn-IN">Kannada (India)</option>
                                <option value="bn-IN">Bengali (India)</option>
                                <option value="mr-IN">Marathi (India)</option>
                                <option value="gu-IN">Gujarati (India)</option>
                                <option value="fr-FR">French (France)</option>
                                <option value="de-DE">German (Germany)</option>
                                <option value="it-IT">Italian (Italy)</option>
                                <option value="pt-BR">Portuguese (Brazil)</option>
                                <option value="zh-CN">Chinese (Mandarin, Simplified)</option>
                                <option value="ja-JP">Japanese (Japan)</option>
                                <option value="ko-KR">Korean (Korea)</option>
                                <option value="ar-SA">Arabic (Saudi Arabia)</option>
                                <option value="ru-RU">Russian (Russia)</option>
                                <option value="th-TH">Thai (Thailand)</option>
                                <option value="vi-VN">Vietnamese (Vietnam)</option>
                                <option value="id-ID">Indonesian (Indonesia)</option>
                                <option value="ms-MY">Malay (Malaysia)</option>
                            </select>
                        </div>
                        
                        <div class="recording-controls-modern">
                            <div class="timer-display" id="timer">00:00</div>
                            <div class="status-text" id="statusIndicator">Ready</div>
                            
                            <div class="main-controls">
                                <button id="startBtn" class="btn-record-modern" title="Start Recording">
                                    <div class="record-dot"></div>
                                </button>
                            </div>
                            
                            <div class="secondary-controls" id="recordingControls" style="display: none;">
                                <button id="pauseBtn" class="btn-control-modern" title="Pause">
                                    <span class="icon">‚è∏</span>
                                </button>
                                <button id="resumeBtn" class="btn-control-modern" title="Resume" style="display: none;">
                                    <span class="icon">‚ñ∂</span>
                                </button>
                                <button id="stopBtn" class="btn-control-modern" title="Stop">
                                    <span class="icon">‚èπ</span>
                                </button>
                                <button id="resetBtn" class="btn-control-modern" title="Reset">
                                    <span class="icon">üîÑ</span>
                                </button>
                            </div>
                        </div>
                        <div class="progress-bar-modern">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <p class="max-duration">Max: 5 mins</p>
                    </div>
                </div>

                <!-- Upload Section -->
                <div class="input-method-section" id="uploadSection">
                    <div class="section-header">
                        <h2>üìÅ Upload Audio</h2>
                    </div>
                    <div class="section-content">
                        <div class="language-selector-compact">
                            <label for="languageSelectUpload">Speaking Language:</label>
                            <select id="languageSelectUpload" class="language-select">
                                <option value="en-US">English (US)</option>
                                <option value="en-GB">English (UK)</option>
                                <option value="es-ES">Spanish (Spain)</option>
                                <option value="es-MX">Spanish (Mexico)</option>
                                <option value="hi-IN">Hindi (India)</option>
                                <option value="ta-IN">Tamil (India)</option>
                                <option value="te-IN">Telugu (India)</option>
                                <option value="ml-IN">Malayalam (India)</option>
                                <option value="kn-IN">Kannada (India)</option>
                                <option value="bn-IN">Bengali (India)</option>
                                <option value="mr-IN">Marathi (India)</option>
                                <option value="gu-IN">Gujarati (India)</option>
                                <option value="fr-FR">French (France)</option>
                                <option value="de-DE">German (Germany)</option>
                                <option value="it-IT">Italian (Italy)</option>
                                <option value="pt-BR">Portuguese (Brazil)</option>
                                <option value="zh-CN">Chinese (Mandarin, Simplified)</option>
                                <option value="ja-JP">Japanese (Japan)</option>
                                <option value="ko-KR">Korean (Korea)</option>
                                <option value="ar-SA">Arabic (Saudi Arabia)</option>
                                <option value="ru-RU">Russian (Russia)</option>
                                <option value="th-TH">Thai (Thailand)</option>
                                <option value="vi-VN">Vietnamese (Vietnam)</option>
                                <option value="id-ID">Indonesian (Indonesia)</option>
                                <option value="ms-MY">Malay (Malaysia)</option>
                            </select>
                        </div>
                        
                        <div class="upload-area-modern" id="uploadArea">
                            <input type="file" id="fileInput" accept="audio/*" hidden>
                            <label for="fileInput" class="upload-label-modern">
                                <span class="icon large">‚òÅÔ∏è</span>
                                <p>Click or Drag File</p>
                                <p class="file-info">MP3, WAV, OGG, M4A</p>
                            </label>
                        </div>
                        <div id="uploadedFileName" class="uploaded-file"></div>
                    </div>
                </div>
            </div>

            <!-- Audio Preview -->
            <div class="card" id="audioPreviewCard" style="display: none;">
                <h2>Audio Preview</h2>
                <audio id="audioPreview" controls></audio>
                
                <div class="language-selector" style="margin: 20px 0;">
                    <label for="outputLanguageSelect">Output Language (Recipe Card):</label>
                    <select id="outputLanguageSelect" class="language-select">
                        <option value="en">English</option>
                        <option value="es">Spanish</option>
                        <option value="hi">Hindi</option>
                        <option value="ta">Tamil</option>
                        <option value="te">Telugu</option>
                        <option value="ml">Malayalam</option>
                        <option value="kn">Kannada</option>
                        <option value="bn">Bengali</option>
                        <option value="mr">Marathi</option>
                        <option value="gu">Gujarati</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                        <option value="it">Italian</option>
                        <option value="pt">Portuguese</option>
                        <option value="zh">Chinese</option>
                        <option value="ja">Japanese</option>
                        <option value="ko">Korean</option>
                        <option value="ar">Arabic</option>
                        <option value="ru">Russian</option>
                        <option value="th">Thai</option>
                        <option value="vi">Vietnamese</option>
                        <option value="id">Indonesian</option>
                        <option value="ms">Malay</option>
                    </select>
                </div>

                <button class="btn btn-primary btn-large" id="transcribeBtn">
                    <span class="icon">üéôÔ∏è</span> Transcribe & Generate Recipe
                </button>
            </div>

            <!-- Loading Section -->
            <div class="card loading-card" id="loadingCard" style="display: none;">
                <div class="spinner"></div>
                <p id="loadingMessage">Processing your audio...</p>
            </div>

            <!-- Recipe Card Display -->
            <div class="card recipe-card" id="recipeCard" style="display: none;">
                <h2>üìñ Your Recipe</h2>
                <div id="recipeContent"></div>
                <div class="recipe-actions">
                    <button class="btn btn-primary" id="saveImageBtn">
                        <span class="icon">üíæ</span> Save as Image
                    </button>
                    <button class="btn btn-info" id="shareBtn" style="background-color: #17a2b8; color: white;">
                        <span class="icon">üì§</span> Share
                    </button>
                    <button class="btn btn-secondary" id="newRecipeBtn">
                        <span class="icon">‚ûï</span> Record Another Recipe
                    </button>
                </div>
            </div>

            <!-- Error Message -->
            <div class="card error-card" id="errorCard" style="display: none;">
                <h2>‚ö†Ô∏è Error</h2>
                <p id="errorMessage"></p>
                <button class="btn btn-secondary" id="retryBtn">Try Again</button>
            </div>
        </main>

        <!-- GALLERY VIEW -->
        <div id="galleryView" style="display: none;">
            <!-- Search and Filter Bar -->
            <div class="card search-card">
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="üîç Search recipes by name, author, or description..." class="search-input">
                    <button class="btn btn-primary" id="searchBtn">Search</button>
                    <button class="btn btn-secondary" id="clearSearchBtn">Clear</button>
                </div>
                <div class="recipe-count">
                    <span id="recipeCount">0 recipes</span>
                </div>
            </div>

            <!-- Recipe Gallery Grid -->
            <div class="gallery-grid" id="galleryGrid">
                <!-- Recipe cards will be dynamically inserted here -->
            </div>

            <!-- Empty State -->
            <div class="empty-state card" id="emptyState" style="display: none;">
                <div class="icon large">üìù</div>
                <h2>No Recipes Yet</h2>
                <p>Start by recording or uploading your first recipe!</p>
                <button class="btn btn-primary" id="goToRecordBtn">
                    <span class="icon">üéôÔ∏è</span> Record Recipe
                </button>
            </div>

            <!-- Loading State for Gallery -->
            <div class="card loading-card" id="galleryLoadingCard" style="display: none;">
                <div class="spinner"></div>
                <p>Loading recipes...</p>
            </div>
        </div>

        </div>

        <!-- Recipe Detail Modal -->
        <div id="recipeModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="modal-close" id="modalClose">&times;</span>
                <div class="modal-header">
                    <h2 id="modalTitle">Recipe Details</h2>
                    <div class="modal-actions">
                        <button class="btn btn-small btn-secondary" id="modalEditBtn">
                            <span class="icon">‚úèÔ∏è</span> Edit
                        </button>
                        <button class="btn btn-small btn-success" id="modalSaveBtn" style="display: none;">
                            <span class="icon">üíæ</span> Save Changes
                        </button>
                        <button class="btn btn-small btn-secondary" id="modalCancelBtn" style="display: none;">
                            <span class="icon">‚úñÔ∏è</span> Cancel
                        </button>
                        <button class="btn btn-small btn-danger" id="modalDeleteBtn">
                            <span class="icon">üóëÔ∏è</span> Delete
                        </button>
                    </div>
                </div>
                <div class="modal-body">
                    <div id="modalRecipeContent"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="modalSaveImageBtn">
                        <span class="icon">üíæ</span> Save as Image
                    </button>
                    <button class="btn btn-info" id="modalShareBtn" style="background-color: #17a2b8; color: white; margin-left: 10px;">
                        <span class="icon">üì§</span> Share
                    </button>
                </div>
            </div>
        </div>

        <!-- Authentication Modal -->
        <div id="authModal" class="modal" style="display: none;">
            <div class="modal-content modal-auth">
                <span class="modal-close" id="authModalClose">&times;</span>
                <div class="modal-header">
                    <h2 id="authModalTitle">Welcome to Recipe Diary</h2>
                </div>
                <div class="modal-body">
                    <div class="auth-tabs">
                        <button class="auth-tab active" id="tabLogin">Login</button>
                        <button class="auth-tab" id="tabMagicLink">Magic Link</button>
                        <button class="auth-tab" id="tabSignup">Sign Up</button>
                    </div>

                    <!-- Login Form -->
                    <form id="loginForm" class="auth-form">
                        <div class="form-group">
                            <label for="loginEmail">Email</label>
                            <input type="email" id="loginEmail" required placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <div id="loginError" class="auth-error" style="display: none;"></div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <span class="icon">üîë</span> Login
                        </button>
                        <div style="text-align: center; margin-top: 15px;">
                            <a href="#" id="forgotPasswordLink" style="color: #4CAF50; text-decoration: none; font-size: 0.9rem;">Forgot password?</a>
                        </div>
                    </form>

                    <!-- Magic Link Form -->
                    <form id="magicLinkForm" class="auth-form" style="display: none;">
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 20px;">Enter your email to receive a one-time login link. No password required!</p>
                        <div class="form-group">
                            <label for="magicLinkEmail">Email</label>
                            <input type="email" id="magicLinkEmail" required placeholder="your@email.com">
                        </div>
                        <div id="magicLinkError" class="auth-error" style="display: none;"></div>
                        <div id="magicLinkSuccess" class="auth-success" style="display: none;"></div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <span class="icon">‚úâÔ∏è</span> Send Magic Link
                        </button>
                    </form>

                    <!-- Password Reset Form -->
                    <form id="resetPasswordForm" class="auth-form" style="display: none;">
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 20px;">Enter your email to receive a password reset link.</p>
                        <div class="form-group">
                            <label for="resetEmail">Email</label>
                            <input type="email" id="resetEmail" required placeholder="your@email.com">
                        </div>
                        <div id="resetError" class="auth-error" style="display: none;"></div>
                        <div id="resetSuccess" class="auth-success" style="display: none;"></div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <span class="icon">üîÑ</span> Send Reset Link
                        </button>
                        <div style="text-align: center; margin-top: 15px;">
                            <a href="#" id="backToLoginLink" style="color: #4CAF50; text-decoration: none; font-size: 0.9rem;">‚Üê Back to Login</a>
                        </div>
                    </form>

                    <!-- Signup Form -->
                    <form id="signupForm" class="auth-form" style="display: none;">
                        <div class="form-group">
                            <label for="signupEmail">Email</label>
                            <input type="email" id="signupEmail" required placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label for="signupPassword">Password</label>
                            <input type="password" id="signupPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6">
                            <small>Minimum 6 characters</small>
                        </div>
                        <div class="form-group">
                            <label for="signupPasswordConfirm">Confirm Password</label>
                            <input type="password" id="signupPasswordConfirm" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>
                        <div id="signupError" class="auth-error" style="display: none;"></div>
                        <div id="signupSuccess" class="auth-success" style="display: none;">
                            Account created! Please check your email to verify your account.
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <span class="icon">‚ú®</span> Create Account
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal" style="display: none;">
            <div class="modal-content settings-modal">
                <span class="modal-close" id="settingsModalClose">&times;</span>
                <div class="modal-header">
                    <h2>‚öôÔ∏è Settings</h2>
                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <h3>Text Size</h3>
                        <p>Adjust the font size for better readability:</p>
                        <div class="font-size-selector" id="fontSizeSelector">
                            <button class="font-option" data-size="small">
                                <span class="preview" style="font-size: 12px;">A</span>
                                <span>Small</span>
                            </button>
                            <button class="font-option" data-size="medium">
                                <span class="preview" style="font-size: 14px;">A</span>
                                <span>Medium</span>
                            </button>
                            <button class="font-option selected" data-size="large">
                                <span class="preview" style="font-size: 16px;">A</span>
                                <span>Large</span>
                            </button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Recipe Card Background</h3>
                        <p>Choose a background for your recipe cards:</p>
                        <div class="background-grid" id="backgroundGrid">
                            <div class="background-option" data-bg="none">
                                <div class="background-preview bg-none">
                                    <span>None</span>
                                </div>
                                <p>Default</p>
                            </div>
                            <div class="background-option" data-bg="peach">
                                <div class="background-preview bg-peach"></div>
                                <p>Peach</p>
                            </div>
                            <div class="background-option" data-bg="mint">
                                <div class="background-preview bg-mint"></div>
                                <p>Mint</p>
                            </div>
                            <div class="background-option" data-bg="lavender">
                                <div class="background-preview bg-lavender"></div>
                                <p>Lavender</p>
                            </div>
                            <div class="background-option" data-bg="sky">
                                <div class="background-preview bg-sky"></div>
                                <p>Sky Blue</p>
                            </div>
                            <div class="background-option" data-bg="rose">
                                <div class="background-preview bg-rose"></div>
                                <p>Rose</p>
                            </div>
                            <div class="background-option" data-bg="lemon">
                                <div class="background-preview bg-lemon"></div>
                                <p>Lemon</p>
                            </div>
                            <div class="background-option" data-bg="coral">
                                <div class="background-preview bg-coral"></div>
                                <p>Coral</p>
                            </div>
                            <div class="background-option" data-bg="sage">
                                <div class="background-preview bg-sage"></div>
                                <p>Sage</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pricing Modal -->
        <div id="pricingModal" class="modal" style="display: none;">
            <div class="modal-content pricing-modal">
                <span class="modal-close" id="pricingModalClose">&times;</span>
                <div class="modal-header">
                    <h2>ü™ô Buy Credits</h2>
                    <p>Generate more recipes with credits. Each recipe costs <span id="recipeCostDisplay">5</span> credits.</p>
                </div>
                <div class="modal-body">
                    <div class="currency-toggle">
                        <label>Currency:</label>
                        <select id="currencySelect">
                            <option value="INR">üáÆüá≥ INR (‚Çπ)</option>
                            <option value="USD">üá∫üá∏ USD ($)</option>
                        </select>
                    </div>
                    
                    <div class="pricing-grid" id="pricingGrid">
                        <!-- Pricing cards will be injected here by JS -->
                        <div style="text-align: center; width: 100%; padding: 20px;">Loading pricing...</div>
                    </div>
                    
                    <div class="payment-info">
                        <p><small>Secure payment via Stripe/Razorpay (Simulated for Demo)</small></p>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Powered by Google Speech-to-Text & Gemini AI</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="app.js"></script>
</body>
</html>

